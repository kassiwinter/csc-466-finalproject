Credit...Emery P. Dalesio/Associated PressMarch 29, 2017ATLANTA — North Carolina’s Republican-controlled legislature and its Democratic governor announced late Wednesday that they had reached an agreement to repeal the controversial state law that curbs legal protections for lesbian, gay, bisexual and transgender people and sets rules that affect transgender bathroom use in public buildings.But gay rights advocates raised objections, arguing that the compromise would continue to allow discrimination. And it was unclear late Wednesday whether the deal, if approved, would end the boycotts by sports leagues, businesses and others that have harmed the state’s reputation and economy.The law in question, often referred to as House Bill 2, was signed in March 2016 by the state’s governor at the time, Pat McCrory, a Republican. One of the most contentious measures requires transgender people in public buildings to use the bathroom that corresponds with the gender on their birth certificate.Phil Berger, the Senate leader, and Tim Moore, the House speaker, announced late Wednesday that they had reached the agreement with the new Democratic governor, Roy Cooper. A bill repealing House Bill 2, which the legislature will consider on Thursday, would also create a moratorium on local nondiscrimination ordinances through 2020 and leave regulation of “multi-occupancy facilities,” or bathrooms, to state lawmakers.“Compromise requires give and take from all sides, and we are pleased this proposal fully protects bathroom safety and privacy,” Mr. Berger and Mr. Moore said in a joint statement.In a brief statement, Mr. Cooper — whose razor-thin victory over Mr. McCrory in November was due in large part to voter frustration over the national backlash over House Bill 2 — said, “I support the House Bill 2 repeal compromise that will be introduced tomorrow. It’s not a perfect deal, but it repeals House Bill 2 and begins to repair our reputation.”Gay rights advocates were harshly critical of the bill. Cathryn Oakley, senior legislative counsel for the Human Rights Campaign, said that the compromise would leave lesbian, gay, bisexual and transgender people with no statewide anti-discrimination ordinance and no ability to seek such protections from local government for a number of years.“What that means for the L.G.B.T. community is that we continue to be boxed out of nondiscrimination protections,” she said.Chris Sgro, executive director of the gay rights group Equality North Carolina, said that the proposal “keeps North Carolina as the only state in the country obsessed with where trans people use the restroom through law.”The announcement on Wednesday came after months of acrimony over the bill and a seeming inability to find middle ground after numerous efforts. Conservative legislators, citing safety concerns, have been worried about the idea of men using women’s restrooms since the Charlotte city government, in February 2016, passed an ordinance that allowed transgender people to use the restroom of their choice. Charlotte officials repealed that ordinance in December as part of one of the efforts to broker a compromise in the state capital, but that effort failed dramatically during a special legislative session.This week, a new flurry of action over House Bill 2 came as the N.C.A.A. warned the state that it could lose the opportunity to host championship sporting events through 2022. The league had already relocated championship tournament games that would have been played in North Carolina during this academic year, including the Division I men’s basketball tournament.The possibility of further punishment placed tremendous pressure on lawmakers in the basketball-obsessed state, a pressure exacerbated by the fact that the University of North Carolina men’s basketball team has reached the N.C.A.A. tournament’s Final Four and will be squaring off against the University of Oregon on Saturday night.The Atlantic Coast Conference also moved its neutral-site championships out of North Carolina this year in response to House Bill 2, and the National Basketball Association moved its All-Star game to New Orleans from Charlotte.Some local news outlets reported this week the N.C.A.A. had set a Thursday deadline for the state to address the bill. Officials at the association could not be reached for comment Wednesday. A league statement last week stated, “Absent any change in the law, our position remains the same regarding hosting current or future events in the state.”The Associated Press released an analysis this week that estimated that House Bill 2 would cost North Carolina more than $3.7 billion in lost business in the next 12 years.